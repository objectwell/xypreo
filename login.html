<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <title>注册 -智足管家</title>
    <meta name="renderer" content="webkit">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport"
        content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=0">
    <link rel="stylesheet" href="./js/plugin/layui/css/layui.css" media="all">
    <link rel="stylesheet" href="./js/plugin/layui/css/admin.css" media="all">
    <link rel="stylesheet" href="./js/plugin/layui/css/login.css" media="all">
    <link rel="stylesheet" href="./css/common.css">
    <style>
        .layadmin-user-login-header h2 {
            font-size: 19px;
        }

        .layadmin-user-login {
            padding: 90px 0;
        }

        .layui-op {
            text-align: right;
        }

        .layui-op button {
            margin: 0 10px;
        }

        .layout {
            width: 600px;
            margin: 0px auto;
            padding-top: 40px;
        }

        .logo-box {
            text-align: center;
            cursor: pointer;
        }

        .logo-box img {
            width: 80px;
            height: 80px;
            margin-bottom: 10px;
        }

        .logo-box h3 {
            margin: 20px 0;
            font-size: 20px;
            height: 26px;
            line-height: 26px;
        }

        .btn-box {
            text-align: right;
        }

        .register-box {
            display: none;
            padding: 30px 60px 30px 0;
        }

        .register-box .layui-form-label {
            width: 160px;
        }

        .register-box .layui-input-block {
            margin-left: 160px;
        }

        .register-box .btn-box {
            padding-top: 20px;
            text-align: center;
        }

        .operation {
            float: right;
        }

        .register {
            color: #1E9FFF;

        }

        .fpassword {
            color: #FF5722;
        }

        .operation .iconfont {
            font-size: 20px;
            display: inline-block;
            float: left;
        }
        .submit-register-box {
            text-align: center;
            padding-left: 60px;
            margin-top: 30px;
        }
        .layui-upload-img {
            height: 38px;
        }
    </style>
</head>

<body>


    <div class="layadmin-user-login layadmin-user-display-show" id="LAY-user-login" style="display: none;">
        <div class="layadmin-user-login-main">
            <div class="layadmin-user-login-box layadmin-user-login-header">
                <h2>智足管家</h2>
            </div>
            <div class="layadmin-user-login-box layadmin-user-login-body layui-form">



                <div class="layui-form-item">
                    <label class="layadmin-user-login-icon layui-icon layui-icon-username"
                        for="LAY-user-login-nickname"></label>
                    <input type="text" name="loginUsername" id="LAY-user-login-nickname" lay-verify="required"
                        lay-verify="required" placeholder="姓名" class="layui-input">
                </div>

                <div class="layui-form-item">
                    <label class="layadmin-user-login-icon layui-icon layui-icon-password"
                        for="LAY-user-login-password"></label>
                    <input type="password" name="loginPassword" id="LAY-user-login-password" lay-verify="required"
                        placeholder="密码" class="layui-input">
                </div>
                <div class="layui-form-item layui-row layui-col-space10">
                    <div class="layui-col-xs6">
                        <button class="layui-btn layui-btn-fluid layui-btn-normal" lay-submit
                            lay-filter="LAY-user-login-submit">登 陆</button>
                    </div>
                    <div class="layui-col-xs6">
                        <button class="layui-btn layui-btn-fluid layui-btn-normal" lay-filter="LAY-user-reg-submit"
                            id="register">注
                            册</button>
                    </div>

                </div>
                <div class="layui-form-item layui-op">
                    <button class="layui-btn layui-btn-sm layui-btn-primary" lay-filter="LAY-user-reg-submit"
                        id="forget">忘记密码</button>
                </div>
            </div>
        </div>
        <div class="register-box" id="registerBox">
            <form class="layui-form">
                <div class="layui-form-item">
                    <label class="layui-form-label">
                        用户名
                    </label>
                    <div class="layui-input-block">
                        <input type="text" name="username" required lay-verify="required" placeholder="请输入用户名"
                            autocomplete="off" class="layui-input">
                    </div>
                </div>
                <div class="layui-form-item">
                    <label class="layui-form-label">
                        密码
                    </label>
                    <div class="layui-input-block">
                        <input type="password" name="password" required lay-verify="required" placeholder="请输入密码"
                            autocomplete="off" class="layui-input">
                    </div>
                </div>
                <div class="layui-form-item">
                    <label class="layui-form-label">
                        手机号码
                    </label>
                    <div class="layui-input-block">
                        <input type="text" name="mobile" required lay-verify="phone" placeholder="请输入手机号码"
                            autocomplete="off" class="layui-input">
                    </div>
                </div>
                <div class="layui-form-item">
                    <label class="layui-form-label">
                        姓名
                    </label>
                    <div class="layui-input-block">
                        <input type="text" name="realname" required lay-verify="required" placeholder="请输入姓名"
                            autocomplete="off" class="layui-input">
                    </div>
                </div>
                <div class="layui-form-item">
                    <label class="layui-form-label">
                        身份证号码
                    </label>
                    <div class="layui-input-block">
                        <input type="text" name="cardno" required lay-verify="identity" placeholder="请输入身份证号码"
                            autocomplete="off" class="layui-input">
                    </div>
                </div>
                <div class="layui-form-item">
                    <label class="layui-form-label">
                        职称/职务
                    </label>
                    <div class="layui-input-block">
                        <select name="position" lay-verify="required" lay-search="">
                            <option value="">请选择职称/职务</option>
                            <option value="1">主治医师</option>
                            <option value="2">复主治医师</option>
                            <option value="3">主任医师</option>
                            <option value="4">住院医师</option>
                            <option value="5">其他</option>
                        </select>
                    </div>
                </div>
                <div class="layui-form-item">
                    <label class="layui-form-label">
                        所属医院及科室
                    </label>
                    <div class="layui-input-inline">
                        <select name="hospital" lay-search="" id="hospitalSelect" lay-filter="hospital" required lay-verify="required">

                        </select>
                    </div>
                    <div class="layui-input-inline">
                        <select name="organizationId" lay-search="" id="organizationSelect" required lay-verify="required">

                        </select>
                    </div>
                </div>
                <div class="layui-form-item">
                    <label class="layui-form-label">
                        头像
                    </label>
                    <div class="layui-input-inline">
                        <button type="button" class="layui-btn" id="avater">
                            <i class="layui-icon">&#xe66f;</i>点击上传头像
                        </button>
                    </div>
                    <div class="layui-input-inline">
                        <img class="layui-upload-img" id="avatarImg">
                            <p id="avatarImgText"></p>
                    </div>
                </div>
                <div class="layui-form-item">
                    <label class="layui-form-label">
                        执照
                    </label>
                    <div class="layui-input-inline">
                        <button type="button" class="layui-btn" id="license">
                            <i class="layui-icon">&#xe64a;</i>点击上传执照
                        </button>
                    </div>
                    <div class="layui-input-inline">
                        <img class="layui-upload-img" id="licenseImg">
                        <p id="licenseImgText"></p>
                    </div>
                    
                </div>
                <div class="layui-form-item">
                    <label class="layui-form-label">
                        擅长
                    </label>
                    <div class="layui-input-block">
                        <input type="text" name="adept"   placeholder="请输入擅长"
                            autocomplete="off" class="layui-input">
                    </div>
                </div>
                <div class="layui-form-item">
                    <label class="layui-form-label">
                        个人简介
                    </label>
                    <div class="layui-input-block">
                        <textarea placeholder="请简单的我描述" class="layui-textarea" name="introduction"></textarea>
                    </div>
                </div>
                <div class="submit-register-box">
                    <button class="layui-btn layui-btn-normal" id="submitRegister" lay-submit
                        lay-filter="submitRegister">注册并登陆</button>
                </div>

            </form>
        </div>
        <div class="layui-trans layadmin-user-login-footer">

            <p>© 2019 智足管家</p>

        </div>

    </div>

    <script src="./js/plugin/toastr/jquery.min.js"></script>
    <script src="./js/plugin/jquery.cookie.js"></script>
    <script src="./js/common/config.js"></script>
    <script src="./js/common/common.js"></script>
    <script src="./js/plugin/layui/layui.js"></script>
    <script src="./js/plugin/toastr/toastr.min.js"></script>
    <script>
        layui.use(['form', 'layer', 'upload'], function () {
            var $ = layui.$
                , layer = layui.layer
                , upload = layui.upload
                , form = layui.form;

            form.render();
            var registerLayer = null;
            //提交
            form.on('submit(LAY-user-login-submit)', function (obj) {
                var field = obj.field;
                var loginData = {
                    username: field.loginUsername,
                    password: field.loginPassword,
                    type: "web",
                    grant_type: "password"
                }
                var loginUrl = ajaxRoot + AJAX_API.user.webLogin;
                $.ajax({
                    type: 'POST',
                    data: loginData,
                    dataType: 'json',
                    // async: true,
                    url: loginUrl,
                    success: function (data) {
                        var utoken = JSON.stringify(data);
                        $.cookie('utoken', utoken, { expires: 1, path: '/' });
                        window.location.href = "./view/doctor/router.html"
                    },
                    complete: function (xhr, msg) {
                    }

                });
                return false;
            });
            $("#register").on("click", function () {
                // 获取 医院
                var hospitalsURL = AJAX_API.common.gethospitals;
                ajaxRequest(hospitalsURL, "GET", {}, "", function (res) {
                    if (res.code == 200) {
                        var data = res.data;
                        var html = ['<option value="">请选择医院</option>']
                        $.each(data, function (i, item) {
                            html.push('<option value="' + item.id + '">' + item.hospital + '</option>')
                        })
                        $("#hospitalSelect").html(html.join(""))
                        form.render('select')
                    }
                })
                registerLayer = layer.open({
                    title: "注册",
                    type: 1,
                    area: ['680px', '560px'],
                    content: $("#registerBox")
                })

                return false
            })
            //  上传执照
            var uploadLicenseOption = {
                upload:upload,
                elem:"#license",
                url:ajaxRoot + AJAX_API.upImg.license,
                imgElem:$("#licenseImg"),
                imgTextElem:$("#licenseImgText")
            }
            var licenseInst = uploadInst (uploadLicenseOption)
            // 上传头像
            var uploadAvaterOption = {
                upload:upload,
                elem:"#avater",
                url:ajaxRoot + AJAX_API.upImg.avater,
                imgElem:$("#avatarImg"),
                imgTextElem:$("#avatarImgText")
            }
            var avaterInst = uploadInst (uploadAvaterOption)
            form.on('select(hospital)', function (data) {
                var val = data.value;
                if (val) {
                    //  获取科室
                    var organizationURL = AJAX_API.common.getdepartments + val;
                    ajaxRequest(organizationURL, "GET", {}, "", function (res) {
                        if (res.code == 200) {
                            var data = res.data;
                            var html = ['<option value="">请选择科室</option>']
                            $.each(data, function (i, item) {
                                html.push('<option value="' + item.organizationId + '">' + item.organizationName + '</option>')
                            })
                            $("#organizationSelect").html(html.join(""))
                            form.render('select')
                        }
                    })
                }
            });
            $("#forget").on("click", function () {
                layer.msg("该功能需要配合短信业务，暂未开噶，敬请期待。。")
            })
            form.on('submit(submitRegister)', function (data) {
                var regData = data.field;
                regData.avatar = $("#avatarImg").attr("src") || "";
                regData.license = $("#licenseImg").attr("src") || "";
                $.ajax({
                    type: "post",
                    url: ajaxRoot + AJAX_API.user.register,
                    data: JSON.stringify(regData),
                    dataType: 'json',
                    contentType: 'application/json',
                    success: function (res) {
                        layer.msg(res.message)
                        layer.close(registerLayer)
                    }
                })
                return false;



            });
        });
    </script>
</body>

</html>