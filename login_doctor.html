<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>湘雅医院糖尿病足互联网平台登录</title>
    <!--[if lt IE 9]>
    <script src="https://cdn.staticfile.org/html5shiv/r29/html5.min.js"></script>
    <script src="https://cdn.staticfile.org/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->
    <link rel="stylesheet" href="./js/plugin/layui/css/layui.css">
    <link rel="stylesheet" href="./js/plugin/toastr/toastr.min.css">
    <link rel="stylesheet" href="./css/common.css">
    <link rel="stylesheet" href="./font/iconfont.css">
    <style>
        .layout {
            width: 600px;
            margin: 0px auto;
            padding-top: 40px;
        }

        .logo-box {
            text-align: center;
            cursor: pointer;
        }

        .logo-box img {
            width: 80px;
            height: 80px;
            margin-bottom: 10px;
        }

        .logo-box h3 {
            margin: 20px 0;
            font-size: 20px;
            height: 26px;
            line-height: 26px;
        }

        .btn-box {
            text-align: right;
        }

        .register-box {
            display: none;
            padding: 30px 60px 30px 0;
        }

        .register-box .layui-form-label {
            width: 110px;
        }

        .register-box .btn-box {
            padding-top: 20px;
            text-align: center;
        }
        .operation {
            float: right;
        }
        .register {
            color: #1E9FFF;

        }
        .fpassword {
            color: #FF5722;
        }
       
        .operation .iconfont {
            font-size: 20px;
            display: inline-block;
            float: left;
        }
    </style>
</head>

<body class="login">
    <div class="layout">
        <div class="logo-box">
            <img src="./imgs/logo.png" alt="logo">
            <h3>中南大学湘雅医院糖尿病足互联网平台</h3>
            <h3>医生登录</h3>
        </div>
        <div class="login">
            <form class="layui-form">
                <div class="layui-form-item">
                    <label class="layui-form-label">
                        <span class="iconfont icon-iconuser-copy"></span>
                    </label>
                    <div class="layui-input-block">
                        <input type="text" name="loginUsername" required lay-verify="required" placeholder="请输入用户名"
                            autocomplete="off" class="layui-input">
                    </div>
                </div>
                <div class="layui-form-item">
                    <label class="layui-form-label">
                        <span class="icon-pwd iconfont"></span>
                    </label>
                    <div class="layui-input-block">
                        <input type="password" name="loginPassword" required lay-verify="required" placeholder="请输入密码"
                            autocomplete="off" class="layui-input">
                    </div>
                </div>
                <div class="layui-form-item">
                    <button class="layui-btn layui-btn-fluid layui-btn-normal" lay-submit
                        lay-filter="login-submit">登陆</button>
                </div>
            </form>
        </div>
        <div class="operation">
            <button type="button" class="layui-btn layui-btn-primary register" id="register">
                <i class="icon-zhucewangzhan iconfont"></i>
                <span>注册</span>
            </button>
            <button type="button" class="layui-btn layui-btn-primary fpassword" id="fpassword">
                <i class="icon-wangjimima iconfont"></i>
                <span>忘记密码</span>
            </button>
        </div>
        <div class="register-box" id="registerBox">
            <form class="layui-form">
                <div class="layui-form-item">
                    <label class="layui-form-label">
                        用户名
                    </label>
                    <div class="layui-input-block">
                        <input type="text" name="username" required lay-verify="required" placeholder="请输入用户名"
                            autocomplete="off" class="layui-input">
                    </div>
                </div>
                <div class="layui-form-item">
                    <label class="layui-form-label">
                        密码
                    </label>
                    <div class="layui-input-block">
                        <input type="password" name="password" required lay-verify="required" placeholder="请输入密码"
                            autocomplete="off" class="layui-input">
                    </div>
                </div>
                <div class="layui-form-item">
                    <label class="layui-form-label">
                        手机号码
                    </label>
                    <div class="layui-input-block">
                        <input type="text" name="mobile" required lay-verify="phone" placeholder="请输入手机号码"
                            autocomplete="off" class="layui-input">
                    </div>
                </div>
                <div class="layui-form-item">
                    <label class="layui-form-label">
                        姓名
                    </label>
                    <div class="layui-input-block">
                        <input type="text" name="realname" required lay-verify="required" placeholder="请输入姓名"
                            autocomplete="off" class="layui-input">
                    </div>
                </div>
                <div class="layui-form-item">
                    <label class="layui-form-label">
                        身份证号码
                    </label>
                    <div class="layui-input-block">
                        <input type="text" name="cardno" required lay-verify="identity" placeholder="请输入身份证号码"
                            autocomplete="off" class="layui-input">
                    </div>
                </div>
                <div class="layui-form-item">
                    <label class="layui-form-label">医院科室</label>
                    <div class="layui-input-inline">
                        <select name="hospitals" lay-verify="required" lay-search id="hospitals" lay-filter="hospitals">
                            <option value="">请选择</option>

                        </select>
                    </div>
                    <div class="layui-input-inline">
                        <select name="organizationId" lay-verify="required" lay-search id="departments" lay-filter>
                            <option value="">请选择</option>
                        </select>
                    </div>
                </div>

                <div class="layui-form-item">
                    <div class="layui-input-block btn-box">
                        <button class="layui-btn" id="submitRegister" lay-submit
                            lay-filter="submitRegister">注册并登陆</button>
                    </div>
                </div>
            </form>
        </div>
    </div>
    <script src="./js/plugin/toastr/jquery.min.js"></script>
    <script src="./js/plugin/jquery.cookie.js"></script>
    <script src="./js/common/config.js"></script>
    <script src="./js/common/common.js"></script>
    <script src="./js/plugin/layui/layui.js"></script>
    <script src="./js/plugin/toastr/toastr.min.js"></script>
    <script>
        $(function () {
            layui.use(['form', 'layer', 'tree'], function () {
                //ajaxRequest
                var form = layui.form;
                var layer = layui.layer;
                var tree = layui.tree;
                var hospitalslisturl = ajaxRoot + AJAX_API.common.gethospitals;
                var departmentslisturl = ajaxRoot + AJAX_API.common.getdepartments;
                var $hospitals = $("#hospitals");
                var $departments = $("#departments");
                var registerLayer = null;
                form.on('submit(login-submit)', function (data) {
                    // layer.msg(JSON.stringify(data.field));

                    var loginData = {
                        username: data.field.loginUsername,
                        password: data.field.loginPassword,
                        type: "web",
                        grant_type: "password"
                    }
                    var loginUrl = ajaxRoot + AJAX_API.user.webLogin;
                    $.ajax({
                        type: 'POST',
                        data: loginData,
                        dataType: 'json',
                        // async: true,
                        url: loginUrl,
                        success: function (data) {
                            var utoken = JSON.stringify(data);
                            $.cookie('utoken', utoken, { expires: 1, path: '/' });
                            window.location.href = "./view/doctor/router.html"
                        },
                        complete: function (xhr, msg) {

                        }

                    });

                    return false;
                });
                $("#register").on("click", function () {
                    // 先渲染select 数据
                    linkage(hospitalslisturl, form, $hospitals);

                    // 再打开
                    registerLayer = layer.open({
                        title: "注册",
                        type: 1,
                        area: ['780px', '560px'],
                        content: $("#registerBox")
                    })

                    return false
                })

                form.on('select(hospitals)', function (data) {
                    var id = data.value;
                    if (id) {
                        var url = departmentslisturl + id;
                        $departments.html('<option value="">请选择</option>')
                        linkage(url, form, $departments);
                    }

                });
                
                form.on('submit(submitRegister)', function (data) {
                    $.ajax({
                        type: "post",
                        url: ajaxRoot + AJAX_API.user.register,
                        data: JSON.stringify(data.field),
                        dataType: 'json',
                        contentType: 'application/json',
                        success: function (res) {
                            form.reset()
                            layer.msg(res.message)
                            layer.close(registerLayer)
                        }
                    })
                    return false;



                });
            })
        })
    </script>
</body>

</html>