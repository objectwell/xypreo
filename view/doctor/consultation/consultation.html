<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>湘雅医院糖尿病足互联网平台我的会诊</title>
    <link rel="stylesheet" href="../../../js/plugin/layui/css/layui.css">
    <link rel="stylesheet" href="../../../js/plugin/toastr/toastr.min.css">
    <link rel="stylesheet" href="../../../font/iconfont.css">
    <link rel="stylesheet" href="../../../css/common.css">
    <style>
        .base-workbench .workbench {
            position: relative;
        }

        .consultation-search {
            position: absolute;
            top: 10px;
            right: 80px;
            width: 200px;
            height: 26px;
            overflow: hidden;
            outline: 0;
            border: 1px solid #e8ecee;
            border-radius: 4px;
        }

        .consultation-search input {
            padding-left: 10px;
            width: 170px;
            height: 26px;
            outline: 0;
            border: 0;
            font-size: 12px;
        }

        .consultation-search:focus-within {
            border-color: #4aca6b;
        }

        .search-icon {
            cursor: pointer;
            position: absolute;
            top: 0;
            right: 0;
            width: 27px;
            height: 26px;
            display: block;
            line-height: 25px;
        }


        .content-item.consulation-none {
            color: #c0c0c0;
            border: none;
            text-align: center;
        }

        .content-item {
            position: relative;
            left: 0;
            top: 0;
            padding: 5px 0 0;
            border-bottom: 1px solid #E8ECEE;
            overflow: hidden;
            max-height: 84px;

        }

        .content-item .notice-img {
            height: 60px;
            width: 60px;
            font-size: 40px;
            float: left;
            line-height: 60px;
            text-align: center;
        }

        .content-div {
            float: left;
            padding-right: 20px;
            font-size: 12px;
            position: relative;
        }

        .content-div .patient-info {

            font-size: 18px;
            color: #333;
            margin-right: 8px;
        }

        .content-div span {
            display: inline-block;
            height: 30px;
            padding-right: 10px;
        }

        .content-div .doctor-info {
            margin-top: 8px;
            margin-bottom: 10px;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
            line-height: 20px;
            font-size: 14px;
            color: #7a8f9a;
            -webkit-font-smoothing: antialiased;
        }


        .content-status {
            float: right;
            margin-right: 100px;
            width: 180px;
        }

        .content-status span {
            display: inline-block;
            height: 30px;
            font-size: 14px;
            color: #009688;
            line-height: 30px;
        }

        .consultation-pages {
            position: relative;
            bottom: 82px;
            text-align: center;
        }

        /* .layui-danger {
            color: #FF5722;
        }
        .layui-normal {
            color: #1E9FFF;
        }
        .layui-primary {
            color: #009688;
        } */
    </style>
</head>

<body>

    <body class="hg100 base-workbench">
        <div class="layout hg100">
            <div class="workbench hg100 " id="workbench">
                <div class="layui-tab layui-tab-brief" lay-filter="tabConsultation">
                    <ul class="layui-tab-title consulation-tab">
                        <li class="layui-this" type="listStart">我发起的</li>
                        <li type="listJoin">我参与的</li>
                    </ul>
                    <div class="consultation-search">
                        <input type="text" placeholder="按关键词筛选" id="searchInput">
                        <span class="search-icon layui-icon layui-icon-search" id="search">


                        </span>
                    </div>
                    <div class="layui-tab-content" id="consultationList">


                    </div>
                </div>

            </div>

        </div>
        <div id="consultationPages" class="consultation-pages"></div>
        <div id="consultationInfo">
            <div class="layui-fluid">
                <div class="layui-row layui-col-space5">
                    <div class="layui-col-md12">
                        <h4 class="info-tips">会诊信息</h4>
                        <div class="layui-col-md12 info-list">
                            <div class="layui-row layui-col-space5">
                                <div class="layui-col-md4 info-list">
                                    <p class="wound-info"><em>会诊类型:</em> <span id="consultationTypeName"></span></p>
                                </div>
                                <div class="layui-col-md4 info-list">
                                    <p class="wound-info"><em>会诊需求:</em> <span id="consultationRequireName"></span></p>
                                </div>
                                <div class="layui-col-md4 info-list">
                                    <p class="wound-info"><em>会诊时间:</em> <span id="consultationRequiTime"></span></p>
                                </div>
                                <div class="layui-col-md4 info-list">
                                    <p class="wound-info"><em>会诊团队:</em> <span id="consultationRequiTeam"></span></p>
                                </div>
                            </div>

                        </div>
                        <h4 class="info-tips">患者信息</h4>
                        <div class="layui-col-md12 info-list">
                            <div class="layui-row layui-col-space5">
                                <div class="layui-col-md4 info-list">
                                    <p class="wound-info"><em>诊疗卡号:</em> <span id="bingLiCard"></span></p>

                                </div>
                                <div class="layui-col-md4 info-list">
                                    <p class="wound-info"><em>身份证号:</em> <span id="cardno"></span></p>
                                </div>
                                <div class="layui-col-md4 info-list">
                                    <p class="wound-info"><em>姓名:</em> <span id="realname"></span></p>
                                </div>
                                <div class="layui-col-md4 info-list">
                                    <p class="wound-info"><em>年龄:</em> <span id="age"></span></p>
                                </div>
                                <div class="layui-col-md4 info-list">
                                    <p class="wound-info"><em>性别:</em> <span id="sex"></span></p>
                                </div>
                            </div>

                        </div>
                    </div>
                    <div class="layui-col-md12">
                        <h4 class="info-tips">伤口深度指数</h4>
                    </div>

                    <div class="layui-col-md12 info-list" id="loader-mater">

                        <div class="layui-progress layui-progress-big" lay-showPercent="true" lay-filter="index">
                            <div class="layui-progress-bar layui-bg-blue" lay-percent="0%" id="progressIndex"></div>
                        </div>
                    </div>
                    <div class="layui-col-md12">
                        <h4 class="info-tips">伤口测量结果</h4>
                    </div>

                    <div class="layui-col-md12 info-list">
                        <div class="layui-row layui-col-space5">
                            <div class="layui-col-md3 info-list">
                                <p class="wound-text"><em>伤口长度(最长):</em> <span id="length"></span>CM</p>

                            </div>
                            <div class="layui-col-md3 info-list">
                                <p class="wound-text"><em>伤口宽度(最宽):</em> <span id="width"></span>CM</p>
                            </div>
                            <div class="layui-col-md3 info-list">
                                <p class="wound-text"><em>伤口深度(最深):</em> <span id="deep"></span>CM</p>
                            </div>
                            <div class="layui-col-md3 info-list">
                                <p class="wound-text"><em>伤口面积(最大):</em> <span id="area"></span>M²</p>
                            </div>
                        </div>

                    </div>
                    <div class="layui-col-md12  echarts-list">
                        <div class="layui-row layui-col-space5">
                            <div class="layui-col-md6 info-list">
                                <div class="wound-pie wound-chart" id="woundPie"></div>
                            </div>
                            <div class="layui-col-md6 info-list">
                                <div class="wound-line wound-chart" id="woundLine"></div>
                            </div>
                        </div>

                    </div>
                    <div class="layui-col-md12">
                        <h4 class="info-tips">全身情况补充</h4>
                    </div>
                    <div class="layui-col-md12 ">
                        <ul class="layui-row layui-col-space5" id="bodyList">
                        </ul>

                    </div>
                    <div class="layui-col-md12">
                        <h4 class="info-tips">伤口分级评估结果</h4>
                    </div>
                    <div class="layui-row layui-col-space5">
                        <div class="layui-col-md12 info-list">
                            <div id="result" class="result">
                            </div>
                        </div>
                    </div>
                    <div class="layui-col-md12">
                        <h4 class="info-tips">伤口图片</h4>
                    </div>
                    <div class="layui-row layui-col-space5">
                        <div class="layui-col-md12 info-list">
                            <div id="woundImageList" class="result">
                            </div>
                        </div>
                    </div>
                    <div class="layui-col-md12">
                        <h4 class="info-tips">病历图片</h4>
                    </div>
                    <div class="layui-row layui-col-space5">
                        <div class="layui-col-md12 info-list">
                            <div id="infoImageList" class="result">
                            </div>
                        </div>
                    </div>
                    <div class="layui-col-md12">
                        <h4 class="info-tips">检验检查报告图片</h4>
                    </div>
                    <div class="layui-row layui-col-space5">
                        <div class="layui-col-md12 info-list">
                            <div id="detecImageList" class="result">
                            </div>
                        </div>
                    </div>
                    <div class="layui-col-md12">
                        <h4 class="info-tips">建议处理方案</h4>
                    </div>
                    <div class="layui-col-md12  echarts-list">
                        <div class=" layui-form" id="analyseForm">
                            <div class="layui-row layui-col-space5">
                                <div class="layui-col-md12 info-list">
                                    <div class="layui-input-block ml0">
                                        <textarea name="plain" placeholder="请输入内容" class="layui-textarea w100"
                                            id="plain"></textarea>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="layui-col-md12">
                            <div class="layui-form-item">
                                <div class="layui-input-block m0 text-center">
                                    <button class="layui-btn layui-btn-normal m10" lay-submit lay-filter="diagnose"
                                        id="create" type="consulation">提交意见</button>
                                </div>
                            </div>
                        </div>

                    </div>
                </div>
            </div>
        </div>
        </div>

        <!-- <script src="../../../js/plugin/rem.min.js"></script> -->
        <script src="../../../js/plugin/jquery.min.js"></script>
        <script src="../../../js/plugin/jquery.cookie.js"></script>
        <script src="../../../js/plugin/toastr/toastr.min.js"></script>
        <script src="../../../js/plugin/layui/layui.js"></script>
        <script src="../../../js/plugin/echarts.min.js"></script>
        <script src="../../../js/plugin/jquery.nicescroll.min.js"></script>
        <script src="../../../js/common/config.js"></script>
        <script src="../../../js/common/common.js"></script>
        <script src="../../../js/common/charts.js"></script>
        <script>
            $(function () {
                var utoken = $.cookie("utoken");
                var access_token;
                var images = [];
                layui.use(["layer", "form", "element", "laypage"], function () {
                    var layer = layui.layer;
                    var element = layui.element;
                    var form = layui.form;
                    var laypage = layui.laypage;
                    if (!utoken) {
                        parent.layer.msg('您尚未登陆或者,或者登陆已过期，请重登陆', {
                            time: 20000, //20s后自动关闭
                            btn: ['重新登陆'],
                            btn1: function () {
                                parent.window.location.href = "../../../login_doctor.html"
                            }
                        });
                    }
                    access_token = JSON.parse(utoken).access_token;


                    // 列表
                    renderList(AJAX_API.consultation.listStart, true)


                    element.on('tab(tabConsultation)', function (data) {
                        var type = data.index;
                        $("#searchInput").val("")
                        if (type == 0) {
                            // 我参与的
                            var url = AJAX_API.consultation.listStart
                            renderList(url, true)
                        } else if (type == 1) {
                            //我发起的
                            var url = AJAX_API.consultation.listJoin
                            renderList(url, true)
                        }
                    })
                    $("#search").on("click", function () {
                        var val = $("#searchInput").val();
                        if (!val) return false
                        var lis = $(".layui-tab-title").find("li");
                        $.each(lis, function (k, l) {
                            var $l = $(l)
                            if ($l.hasClass("layui-this")) {
                                if ($l.attr("type")) {
                                    var type = $l.attr("type");
                                    var url = AJAX_API.consultation[type] + "?keyword=" + val;
                                    renderList(url, true)
                                }

                            }
                        })


                    })

                    function renderList(url, init) {
                        var listLayerIndex = layerLoading(layer, parent)

                        ajaxRequest(url, "get", {}, access_token, function (res) {
                            if (res.data) {
                                if (init) {
                                    laypage.render({
                                        elem: 'consultationPages'
                                        , count: res.data.total
                                        , limit: 5
                                        , jump: function (e, first) {
                                            if (!first) {
                                                var pageNum = e.curr;
                                                var pageurl = AJAX_API.consultation[$(".layui-this").attr("type")] + "?pageNum=" + pageNum
                                                renderList(pageurl, false)
                                            }

                                        }
                                    });
                                }
                            } 


                            $("#consultationList").html("")
                            var data = res.data;
                            if (data) {
                                var list = data.consulations
                                var html = [];
                                if (list.length != 0) {
                                    var html = []
                                    $.each(list, function (i, li) {
                                        var stateText = "";
                                        var cls = ""
                                        if (li.state == "audit") {
                                            stateText = "待审核"
                                            cls = "layui-danger"
                                        } else if (li.state == "reply") {
                                            stateText = "待回复"
                                            cls = "layui-normal"
                                        } else if (li.state == "complete") {
                                            stateText = "已完成"
                                            cls = "layui-primary"
                                        }
                                        var str = '<div class="content-item" bingLiId="' + li.bingLiId + '">\
                                            <span class="notice-img icon iconfont icon-lingdang"></span>\
                                            <div class="content-div" id="">\
                                                <p class="patient-info">\
                                                    <em>姓名：<span > '+ li.realname + ' </span></em>\
                                                    <em>会诊类型: <span > '+ li.consultation_type_name + ' </span></em>\
                                                </p>\
                                                <p class="doctor-info">\
                                                    <em>医院名称：<span  >'+ li.hospital + '</span></em>\
                                                    <em>科室名称：<span  >'+ li.department + '</span></em>\
                                                    <em>医生：<span  >'+ li.doctor + '</span></em>\
                                                </p>\
                                            </div>\
                                            <div class="content-status">\
                                                <p>\
                                                    <em>状态：<span id="status" class="'+ cls + '"> ' + stateText + ' </span></em>\
                                                </p>\
                                                <p> <em>时间：<span class="data-time" id="dataTime">'+ li.date + '</span> </em></p>\
                                            </div>\
                                        </div>'
                                        html.push(str)
                                    });
                                    $("#consultationList").html(html.join(""))
                                    $("#consultationList").off("click").on("click", ".content-item", function () {
                                        var bingliId = $(this).attr("bingliId");
                                        if (!bingliId) return false
                                        parent.layer.open({
                                            type: 2,
                                            content: "/view/doctor/consultation/consultationDetail.html?bingliId=" + bingliId,
                                            area: ["1000px", "680px"],
                                            title: "会诊详情"
                                        })
                                        return false

                                    })
                                } else {
                                    $("#consultationList").html('<li class="consulation-none content-item">暂时没有数据</li>')
                                }
                            }else {
                                $("#consultationList").html('<li class="consulation-none content-item">暂时没有数据</li>')
                            }


                            closeLayer(listLayerIndex, parent)
                        })
                    }

                })

            })
        </script>
    </body>

</html>